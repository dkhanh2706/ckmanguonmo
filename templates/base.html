<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>
      {% block title %}
      {% if page_title %}{{ page_title }} – Khánh - Tiến{% else %}Khánh - Tiến{% endif %}
      {% endblock %}
    </title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- CSS chung -->
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- CSS cho trang công thức (nếu không dùng vẫn không sao) -->
    <link rel="stylesheet" href="/static/css/recipes.css" />

    <!-- Page header nhỏ, áp dụng cho mọi trang -->
    <style>
      body {
        background: radial-gradient(circle at top, #e0f2fe 0, #f9fafb 40%, #f3f4f6 100%);
        font-family: "Noto Sans JP", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      .page-hero {
        width: min(1400px, 100% - 40px);
        margin: 80px auto 16px;
        padding: 18px 22px;
        border-radius: 16px;
        background: linear-gradient(135deg, #eff6ff, #e0f2fe);
        border: 1px solid #bfdbfe;
        box-shadow: 0 10px 25px rgba(30, 64, 175, 0.12);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
      }

      .main {
        width: min(1400px, 100% - 40px);
        margin: 0 auto 40px;
        padding: 0 0 40px;
      }


      .page-hero-main {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .page-hero-title {
        margin: 0;
        font-size: 1.6rem;
        font-weight: 700;
        color: #1d4ed8;
      }

      .page-hero-subtitle {
        margin: 0;
        font-size: 0.9rem;
        color: #475569;
      }

      .page-hero-badge {
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.05);
        color: #0f172a;
        font-size: 0.75rem;
      }

      @media (max-width: 768px) {
        .page-hero {
          margin-top: 72px;
          padding: 14px 14px;
          flex-direction: column;
          align-items: flex-start;
        }

        .page-hero-title {
          font-size: 1.3rem;
        }
      }

      .main {
        max-width: 1200px;
        margin: 0 auto 40px;
        padding: 0 12px 40px;
      }
    </style>

    {% block head_extra %}{% endblock %}
  </head>

  <body>
    <div class="bg-overlay"></div>

    <!-- ================= NAVBAR ================= -->
    <header class="header">
      <!-- Logo -->
      <a href="/" class="logo">
        <div class="logo-mark">雪</div>
        <span class="logo-text">Khánh - Tiến</span>
      </a>

      <!-- Menu, sẽ được JS thay đổi nếu user đã đăng nhập -->
      <nav class="nav" id="main-nav">
        <!-- Menu mặc định khi CHƯA đăng nhập -->
        <a href="/" class="nav-link">
          <i class="fas fa-home"></i> Trang chủ
        </a>
        <a href="/meal-planner" class="nav-link">
          <i class="fas fa-calendar-alt"></i> Lịch ăn uống
        </a>
        <a href="/recipes" class="nav-link">
          <i class="fas fa-book"></i> Công thức
        </a>
        <a href="/shopping-list" class="nav-link">
          <i class="fas fa-shopping-cart"></i> Mua sắm
        </a>
        <a href="/login" class="nav-link">
          <i class="fas fa-sign-in-alt"></i> Đăng nhập
        </a>
        <a href="/register" class="nav-link">
          <i class="fas fa-user-plus"></i> Đăng ký
        </a>
      </nav>
    </header>

    <!-- ================ PAGE HERO (TIÊU ĐỀ TRANG) ================ -->
    {% if page_title %}
    <section class="page-hero">
      <div class="page-hero-main">
        <h1 class="page-hero-title">{{ page_title }}</h1>
        <p class="page-hero-subtitle">
          {% if page_title == "Lịch ăn uống hằng tuần" %}
          Lên kế hoạch bữa ăn khoa học cho sinh viên & người tập gym, chỉ với vài thao tác kéo thả.
          {% elif page_title == "Công thức nấu ăn" %}
          Bộ sưu tập công thức đơn giản, dễ nấu, phù hợp cho cuộc sống bận rộn.
          {% else %}
          Quy hoạch bữa ăn, công thức & danh sách mua sắm một cách nhẹ nhàng và trực quan.
          {% endif %}
        </p>
      </div>
      <div class="page-hero-badge">
        <i class="fa-solid fa-seedling"></i>
        Eat better. Plan smarter.
      </div>
    </section>
    {% endif %}

    <!-- ================ MAIN CONTENT ================ -->
    <main class="main">
      {% block content %}{% endblock %}
    </main>

    <!-- ================ FOOTER ================ -->
    <footer class="footer">
      <p>
        Made with
        <i class="fas fa-heart" style="color: #ef4444"></i>
        &
        <i class="fas fa-mug-hot" style="color: #7c3aed"></i>
        in Japan style
      </p>
      <p style="font-size: 12px; color: #9ca3af">
        Khánh - Tiến – Simple Recipe & Meal Planning Demo
      </p>
    </footer>

    <!-- JS chung -->
    <script src="/static/js/main.js"></script>

    <!-- Dynamic Navigation Script -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const userJson = localStorage.getItem("user");
        const navElement = document.getElementById("main-nav");

        // ========== 1. Nếu có user trong localStorage -> đổi menu ==========
        if (userJson && navElement) {
          try {
            const user = JSON.parse(userJson);
            const displayName =
              (user.full_name && user.full_name.trim()) ||
              user.email ||
              "Bạn";

            navElement.innerHTML = `
              <span class="nav-hello">
                  <i class="fas fa-user-circle"></i> ${displayName}
              </span>
              <a href="/" class="nav-link">
                  <i class="fas fa-home"></i> Trang chủ
              </a>
              <a href="/meal-planner" class="nav-link">
                  <i class="fas fa-calendar-alt"></i> Lịch ăn uống
              </a>
              <a href="/recipes" class="nav-link">
                  <i class="fas fa-book"></i> Công thức
              </a>
              <a href="/shopping-list" class="nav-link">
                  <i class="fas fa-shopping-cart"></i> Mua sắm
              </a>
              <a href="/order-history" class="nav-link">
                <i class="fas fa-receipt"></i> Lịch sử mua hàng
              </a>
              <a href="#" id="logoutBtn" class="nav-link">
                  <i class="fas fa-sign-out-alt"></i> Đăng xuất
              </a>
            `;

            // Xử lý logout
            const logoutBtn = document.getElementById("logoutBtn");
            if (logoutBtn) {
              logoutBtn.addEventListener("click", function (e) {
                e.preventDefault();
                localStorage.removeItem("user");
                window.location.href = "/";
              });
            }
          } catch (e) {
            console.error("Lỗi khi parse user data:", e);
          }
        }

        // ========== 2. Thêm hiệu ứng ACTIVE cho nav-link hiện tại ==========
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll(".nav-link");

        navLinks.forEach((link) => {
          const href = link.getAttribute("href");
          if (!href) return;

          if (href === currentPath) {
            link.classList.add("nav-link-active");
          }
        });
      });
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>