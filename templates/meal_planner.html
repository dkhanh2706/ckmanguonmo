{% extends "base.html" %} {% block title %}Meal Planner{% endblock %} {% block
content %}

<style>
  :root {
    --bg: #f8fafc;
    --card: #ffffff;
    --border: #e2e8f0;
    --muted: #64748b;
    --text: #0f172a;
    --soft: #f1f5f9;
  }
  body {
    background: var(--bg);
  }

  .planner-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 14px 10px 48px;
  }
  .title-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 10px;
  }
  .title {
    font-size: 1.25rem;
    font-weight: 900;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .subtitle {
    margin: 2px 0 0;
    color: var(--muted);
    font-size: 0.92rem;
  }

  /* ===== Summary cards ===== */
  .summary-grid {
    display: grid;
    grid-template-columns: 1.1fr 0.9fr;
    gap: 12px;
    margin: 12px 0 14px;
  }
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06);
    overflow: hidden;
  }
  .card-h {
    padding: 12px 14px;
    background: #f8fafc;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
  }
  .card-h h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 800;
    color: var(--text);
  }
  .badge {
    font-size: 0.75rem;
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid #e0e7ff;
    background: #eef2ff;
    color: #475569;
    white-space: nowrap;
  }
  .card-b {
    padding: 12px 14px 14px;
  }
  .note {
    margin: 0 0 10px;
    color: var(--muted);
    font-size: 0.85rem;
  }

  .mini-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }
  .mini-table th,
  .mini-table td {
    border-bottom: 1px solid var(--border);
    padding: 8px 6px;
    vertical-align: top;
  }
  .mini-table th {
    text-align: left;
    background: #f9fafb;
    color: #334155;
    font-weight: 800;
  }

  .kpi-row {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 10px;
    margin-top: 12px;
  }
  .kpi {
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 10px;
    background: #fff;
  }
  .kpi .l {
    font-size: 0.75rem;
    color: var(--muted);
    margin-bottom: 2px;
  }
  .kpi .v {
    font-size: 0.95rem;
    font-weight: 900;
    color: var(--text);
  }

  @media (max-width: 980px) {
    .summary-grid {
      grid-template-columns: 1fr;
    }
    .kpi-row {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  /* ===== Toolbar ===== */
  .toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 999px;
    padding: 8px 12px;
    margin: 10px 0 14px;
  }
  .toolbar .left {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }
  .toolbar .right {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }
  .btn {
    border-radius: 999px;
    padding: 7px 12px;
    border: 1px solid #cbd5e1;
    background: #fff;
    font-size: 0.86rem;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: background 0.15s, transform 0.1s, box-shadow 0.1s;
  }
  .btn:hover {
    background: #e2e8f0;
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(148, 163, 184, 0.35);
  }
  .btn:active {
    transform: translateY(0);
    box-shadow: none;
  }
  .week-label {
    font-size: 0.86rem;
    color: #334155;
    font-weight: 700;
  }

  /* ===== Calendar ===== */
  .calendar-grid {
    display: grid;
    grid-template-columns: 120px repeat(7, 1fr);
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06);
    margin-bottom: 18px;
  }
  .cal-head {
    background: var(--soft);
    padding: 10px 6px;
    text-align: center;
    border-bottom: 1px solid var(--border);
    font-weight: 800;
    font-size: 0.82rem;
  }
  .cal-head .iso {
    display: block;
    font-size: 0.72rem;
    color: #94a3b8;
    font-weight: 600;
    margin-top: 2px;
  }

  .slot-label {
    background: #f8fafc;
    padding: 12px 10px;
    border-bottom: 1px solid var(--border);
    border-right: 1px solid var(--border);
    font-weight: 800;
    color: #0f172a;
    font-size: 0.9rem;
  }
  .cell {
    min-height: 86px;
    padding: 7px 8px;
    border-bottom: 1px solid var(--border);
    border-right: 1px solid var(--border);
    background: #fff;
    font-size: 0.82rem;
    cursor: pointer;
    position: relative;
    transition: background 0.12s;
  }
  .cell:hover {
    background: #f8fafc;
  }
  .cell.drop {
    outline: 2px dashed #22c55e;
    outline-offset: -3px;
    background: #f0fdf4 !important;
  }
  .placeholder {
    color: #94a3b8;
    font-style: italic;
    font-size: 0.78rem;
  }
  .tag {
    display: inline-block;
    padding: 3px 9px;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 800;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .tag.student {
    background: #eff6ff;
    color: #1d4ed8;
  }
  .tag.gym {
    background: #ecfdf5;
    color: #047857;
  }
  .hint {
    margin-top: 4px;
    color: #94a3b8;
    font-size: 0.76rem;
  }

  /* ===== Recipe lists ===== */
  .section-title {
    margin: 12px 0 6px;
    font-size: 1rem;
    font-weight: 900;
    color: #0f172a;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .section-sub {
    margin: 0 0 10px;
    color: var(--muted);
    font-size: 0.85rem;
  }

  .recipes {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
    gap: 12px;
    margin-bottom: 16px;
  }
  .r-card {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 14px;
    padding: 10px;
    box-shadow: 0 1px 4px rgba(15, 23, 42, 0.06);
    cursor: grab;
    transition: transform 0.12s, box-shadow 0.12s, border-color 0.12s;
  }
  .r-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 14px rgba(15, 23, 42, 0.1);
    border-color: #bfdbfe;
  }
  .r-title {
    font-weight: 900;
    color: #0f172a;
    margin-bottom: 2px;
  }
  .r-note {
    color: #6b7280;
    font-size: 0.82rem;
    margin-bottom: 6px;
  }
  .chip {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 999px;
    border: 1px solid #e5e7eb;
    background: #f3f4f6;
    color: #4b5563;
    font-size: 0.75rem;
    font-weight: 700;
  }

  /* ===== Print ===== */
  @media print {
    body * {
      visibility: hidden;
    }
    #print-area,
    #print-area * {
      visibility: visible;
    }
    #print-area {
      display: block !important;
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      background: #fff;
    }
  }
</style>

<div class="planner-container">
  <div class="title-row">
    <div>
      <div class="title">üìÖ Meal Planner ‚Äì L·ªãch ƒÉn u·ªëng</div>
      <p class="subtitle">
        K√©o th·∫£ m√≥n ƒÉn v√†o l·ªãch tu·∫ßn (S√°ng/Tr∆∞a/T·ªëi). Xu·∫•t PDF Ng√†y/Tu·∫ßn ƒë·ªÉ ƒë√°nh
        gi√° ch·∫ø ƒë·ªô ƒÉn (s·ªë li·ªáu minh ho·∫°).
      </p>
    </div>
  </div>

  <!-- Summary / ƒë√°nh gi√° minh ho·∫° -->
  <div class="summary-grid">
    <div class="card" id="daily-sample">
      <div class="card-h">
        <h3>‚òÄÔ∏è Th·ª±c ƒë∆°n 1 ng√†y m·∫´u</h3>
        <span class="badge">Minh ho·∫°</span>
      </div>
      <div class="card-b">
        <p class="note">
          M·ª•c ƒë√≠ch: cho ng∆∞·ªùi xem ƒë√°nh gi√° nhanh logic ch·∫ø ƒë·ªô ƒÉn (kh√¥ng c·∫ßn ƒë√∫ng
          s·ªë li·ªáu dinh d∆∞·ª°ng).
        </p>
        <table class="mini-table">
          <thead>
            <tr>
              <th style="width: 18%">B·ªØa</th>
              <th>M√≥n ƒÉn</th>
              <th style="width: 18%">NƒÉng l∆∞·ª£ng</th>
              <th style="width: 22%">Ghi ch√∫</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><b>S√°ng</b></td>
              <td>B√°nh m√¨ tr·ª©ng + s·ªØa</td>
              <td>~350 kcal</td>
              <td>ƒê·ªß nƒÉng l∆∞·ª£ng</td>
            </tr>
            <tr>
              <td><b>Tr∆∞a</b></td>
              <td>C∆°m + ·ª©c g√† + rau</td>
              <td>~520 kcal</td>
              <td>C√¢n b·∫±ng</td>
            </tr>
            <tr>
              <td><b>T·ªëi</b></td>
              <td>Salad + tr√°i c√¢y</td>
              <td>~320 kcal</td>
              <td>Nh·∫π, d·ªÖ ti√™u</td>
            </tr>
          </tbody>
        </table>

        <div class="kpi-row">
          <div class="kpi">
            <div class="l">üî• T·ªïng kcal</div>
            <div class="v">~1,190</div>
          </div>
          <div class="kpi">
            <div class="l">ü•© ƒê·∫°m</div>
            <div class="v">Minh ho·∫°</div>
          </div>
          <div class="kpi">
            <div class="l">ü•¶ Rau</div>
            <div class="v">Minh ho·∫°</div>
          </div>
          <div class="kpi">
            <div class="l">‚úÖ ƒê√°nh gi√°</div>
            <div class="v">Kh√° ·ªïn</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card" id="weekly-sample">
      <div class="card-h">
        <h3>üóìÔ∏è T·ªïng quan 1 tu·∫ßn m·∫´u</h3>
        <span class="badge">Report</span>
      </div>
      <div class="card-b">
        <p class="note">
          Nh√¨n t·ªïng th·ªÉ 7 ng√†y ƒë·ªÉ nh·∫≠n x√©t: ƒëa d·∫°ng m√≥n, ƒë·∫°m/rau, c√≥ ng√†y eat
          clean xen k·∫Ω kh√¥ng.
        </p>
        <table class="mini-table">
          <thead>
            <tr>
              <th style="width: 26%">Ng√†y</th>
              <th>ƒê·∫∑c ƒëi·ªÉm</th>
              <th style="width: 30%">Nh·∫≠n x√©t</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><b>Th·ª© 2</b></td>
              <td>Tinh b·ªôt v·ª´a</td>
              <td>H·ª£p ng√†y h·ªçc</td>
            </tr>
            <tr>
              <td><b>Th·ª© 3</b></td>
              <td>Eat clean nh·∫π</td>
              <td>Gi·∫£m d·∫ßu</td>
            </tr>
            <tr>
              <td><b>Th·ª© 4</b></td>
              <td>ƒê·∫°m cao</td>
              <td>H·ª£p ng√†y t·∫≠p</td>
            </tr>
            <tr>
              <td><b>Th·ª© 5</b></td>
              <td>C√¢n b·∫±ng</td>
              <td>·ªîn ƒë·ªãnh</td>
            </tr>
            <tr>
              <td><b>Th·ª© 6</b></td>
              <td>Thi·∫øu rau</td>
              <td>B·ªï sung canh</td>
            </tr>
            <tr>
              <td><b>Th·ª© 7</b></td>
              <td>Tho·∫£i m√°i</td>
              <td>Kh√¥ng qu√° nghi√™m</td>
            </tr>
            <tr>
              <td><b>CN</b></td>
              <td>Nh·∫π nh√†ng</td>
              <td>D·ªÖ ti√™u</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="left">
      <button class="btn" id="prev-week-btn">‚¨Ö Tu·∫ßn tr∆∞·ªõc</button>
      <button class="btn" id="today-week-btn">üìÖ Tu·∫ßn hi·ªán t·∫°i</button>
      <button class="btn" id="next-week-btn">Tu·∫ßn sau ‚û°</button>
    </div>
    <div class="right">
      <span class="week-label" id="week-range-label"></span>
      <button class="btn" id="export-day-pdf-btn">üìÑ PDF Ng√†y</button>
      <button class="btn" id="export-week-pdf-btn">üìä PDF Tu·∫ßn</button>
    </div>
  </div>

  <!-- Calendar -->
  <div id="calendar-root"></div>

  <!-- Recipe lists -->
  <div class="section-title">üçö M√≥n cho sinh vi√™n ·ªü tr·ªç</div>
  <p class="section-sub">
    K√©o m√≥n t·ª´ d∆∞·ªõi l√™n c√°c √¥ l·ªãch. √î tr·ªëng s·∫Ω hi·ªÉn th·ªã ‚ÄúK√©o m√≥n v√†o ƒë√¢y‚Äù.
    (Chu·ªôt ph·∫£i v√†o √¥ ƒë·ªÉ xo√° m√≥n)
  </p>
  <div id="student-recipes" class="recipes"></div>

  <div class="section-title">üí™ M√≥n Gym / Eat clean</div>
  <p class="section-sub">
    Danh s√°ch m√≥n healthy. K√©o th·∫£ ƒë·ªÉ l√™n th·ª±c ƒë∆°n tƒÉng c∆°/gi·∫£m m·ª° (minh ho·∫°).
  </p>
  <div id="gym-recipes" class="recipes"></div>
</div>

<!-- Print area -->
<div id="print-area" style="display: none"></div>

<script>
  // meal_planner.js s·∫Ω c·∫≠p nh·∫≠t khi click √¥
  window.__selectedDayISO = new Date().toISOString().slice(0, 10);

  function buildPrintHTML({ title, subTitle, contentHTML }) {
    return `
      <div style="font-family: Arial, sans-serif; padding: 18px;">
        <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px;">
          <div>
            <h2 style="margin:0 0 6px; color:#0f172a;">${title}</h2>
            <div style="margin:0 0 12px; color:#64748b; font-size: 13px;">${
              subTitle || ""
            }</div>
          </div>
          <div style="font-size:12px; color:#94a3b8; text-align:right;">
            Meal Planner<br/>Xu·∫•t PDF (minh ho·∫°)
          </div>
        </div>
        <div>${contentHTML}</div>
        <div style="margin-top:14px; color:#94a3b8; font-size: 12px;">
          G·ª£i √Ω: Ctrl+P ‚Üí Save as PDF
        </div>
      </div>
    `;
  }

  /* =========================
     PDF NG√ÄY: B·∫¢NG 3 B·ªÆA ƒê·∫∏P
     ========================= */
  function exportDayPDF() {
    const selectedDayISO =
      window.__selectedDayISO || new Date().toISOString().slice(0, 10);

    const breakfastCell = document.querySelector(
      `.cell[data-date="${selectedDayISO}"][data-meal-type="breakfast"]`
    );
    const lunchCell = document.querySelector(
      `.cell[data-date="${selectedDayISO}"][data-meal-type="lunch"]`
    );
    const dinnerCell = document.querySelector(
      `.cell[data-date="${selectedDayISO}"][data-meal-type="dinner"]`
    );

    const getTitle = (cell) =>
      (cell?.getAttribute("data-recipe-title") || "").trim();
    const bTitle = getTitle(breakfastCell) || "Ch∆∞a c√≥ m√≥n";
    const lTitle = getTitle(lunchCell) || "Ch∆∞a c√≥ m√≥n";
    const dTitle = getTitle(dinnerCell) || "Ch∆∞a c√≥ m√≥n";

    // kcal minh ho·∫°
    const kcalFor = (title, base) =>
      title === "Ch∆∞a c√≥ m√≥n" ? "-" : `~${base} kcal`;
    const bKcal = kcalFor(bTitle, 320);
    const lKcal = kcalFor(lTitle, 520);
    const dKcal = kcalFor(dTitle, 380);

    const sumKcal = () => {
      const toNum = (s) => (String(s).match(/~(\d+)/) ? Number(RegExp.$1) : 0);
      const total = toNum(bKcal) + toNum(lKcal) + toNum(dKcal);
      return total ? `~${total} kcal` : "-";
    };

    const html = `
      <style>
        .pdf-badge{display:inline-block;padding:3px 10px;border-radius:999px;border:1px solid #e2e8f0;background:#f8fafc;font-size:12px;color:#334155;margin-right:6px;}
        .pdf-table{width:100%;border-collapse:collapse;font-size:13px;}
        .pdf-table th,.pdf-table td{border:1px solid #e2e8f0;padding:10px 8px;vertical-align:top;}
        .pdf-table th{background:#f1f5f9;text-align:left;color:#0f172a;}
        .pdf-muted{color:#64748b;font-size:12px;}
        .pdf-kpi{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
        .pdf-kpi .box{border:1px solid #e2e8f0;border-radius:12px;padding:10px;min-width:170px;}
        .pdf-kpi .l{font-size:12px;color:#64748b;}
        .pdf-kpi .v{font-size:14px;font-weight:900;color:#0f172a;margin-top:2px;}
      </style>

      <div style="margin-bottom:10px;">
        <span class="pdf-badge">Ng√†y: ${selectedDayISO}</span>
        <span class="pdf-badge">S·ªë li·ªáu minh ho·∫°</span>
      </div>

      <table class="pdf-table">
        <thead>
          <tr>
            <th style="width:18%;">B·ªØa</th>
            <th>M√≥n ƒÉn</th>
            <th style="width:18%;">NƒÉng l∆∞·ª£ng</th>
            <th style="width:26%;">Nh·∫≠n x√©t</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><b>üç≥ S√°ng</b></td><td>${bTitle}</td><td>${bKcal}</td><td class="pdf-muted">N·∫°p nƒÉng l∆∞·ª£ng ƒë·∫ßu ng√†y</td></tr>
          <tr><td><b>üç± Tr∆∞a</b></td><td>${lTitle}</td><td>${lKcal}</td><td class="pdf-muted">C√¢n b·∫±ng ƒë·∫°m ‚Äì tinh b·ªôt</td></tr>
          <tr><td><b>ü•ó T·ªëi</b></td><td>${dTitle}</td><td>${dKcal}</td><td class="pdf-muted">Nh·∫π, d·ªÖ ti√™u ho√°</td></tr>
        </tbody>
      </table>

      <div class="pdf-kpi">
        <div class="box"><div class="l">üî• T·ªïng kcal (minh ho·∫°)</div><div class="v">${sumKcal()}</div></div>
        <div class="box"><div class="l">ü•© ƒê·∫°m</div><div class="v">Minh ho·∫°</div></div>
        <div class="box"><div class="l">ü•¶ Rau xanh</div><div class="v">Minh ho·∫°</div></div>
      </div>

      <p class="pdf-muted" style="margin-top:10px;">
        Ghi ch√∫: PDF Ng√†y l·∫•y d·ªØ li·ªáu t·ª´ c√°c m√≥n b·∫°n ƒë√£ k√©o th·∫£ v√†o l·ªãch tu·∫ßn.
      </p>
    `;

    document.getElementById("print-area").innerHTML = buildPrintHTML({
      title: "B√ÅO C√ÅO TH·ª∞C ƒê∆†N NG√ÄY",
      subTitle:
        "B·∫£ng 3 b·ªØa (S√°ng/Tr∆∞a/T·ªëi) ‚Äì ph·ª•c v·ª• ƒë√°nh gi√° ch·∫ø ƒë·ªô ƒÉn (minh ho·∫°).",
      contentHTML: html,
    });
    window.print();
  }

  /* =========================
     PDF TU·∫¶N: REPORT ƒê·∫∏P
     ========================= */
  function exportWeekPDF() {
    const weekLabel =
      document.getElementById("week-range-label")?.innerText || "";

    // l·∫•y 7 ng√†y t·ª´ header ISO trong grid
    const dayISO = Array.from(document.querySelectorAll(".cal-head .iso")).map(
      (x) => x.textContent.trim()
    );
    // dayISO g·ªìm 7 ph·∫ßn t·ª≠ (Mon->Sun)

    // gom d·ªØ li·ªáu theo ng√†y: {date: {breakfast, lunch, dinner}}
    const byDay = {};
    dayISO.forEach(
      (d) =>
        (byDay[d] = {
          breakfast: "Ch∆∞a c√≥ m√≥n",
          lunch: "Ch∆∞a c√≥ m√≥n",
          dinner: "Ch∆∞a c√≥ m√≥n",
        })
    );

    document.querySelectorAll(".cell").forEach((cell) => {
      const d = cell.getAttribute("data-date");
      const mt = cell.getAttribute("data-meal-type");
      const title =
        (cell.getAttribute("data-recipe-title") || "").trim() || "Ch∆∞a c√≥ m√≥n";
      if (byDay[d] && byDay[d][mt] !== undefined) byDay[d][mt] = title;
    });

    // th·ªëng k√™ minh ho·∫°
    let plannedMeals = 0;
    let emptyMeals = 0;
    let gymCount = 0;
    let studentCount = 0;

    document.querySelectorAll(".cell").forEach((cell) => {
      const title = (cell.getAttribute("data-recipe-title") || "").trim();
      if (!title) {
        emptyMeals++;
        return;
      }
      plannedMeals++;

      const cls = cell.getAttribute("data-recipe-class") || "";
      if (cls === "gym") gymCount++;
      else if (cls === "student") studentCount++;
    });

    const diversityNote =
      plannedMeals >= 12
        ? "Kh√° ƒëa d·∫°ng"
        : plannedMeals >= 6
        ? "Trung b√¨nh"
        : "C√≤n √≠t";
    const balanceNote =
      gymCount > 0 && studentCount > 0
        ? "C√≥ c√¢n b·∫±ng nh√≥m m√≥n"
        : "N√™n xen k·∫Ω nh√≥m m√≥n";

    // b·∫£ng t·ªïng h·ª£p 7 ng√†y
    let rows = "";
    dayISO.forEach((d) => {
      const b = byDay[d].breakfast;
      const l = byDay[d].lunch;
      const di = byDay[d].dinner;

      // kcal minh ho·∫° theo ng√†y: n·∫øu ƒë·ªß 3 b·ªØa th√¨ ~1200..1500, n·∫øu √≠t th√¨ th·∫•p
      const countInDay = [b, l, di].filter((x) => x !== "Ch∆∞a c√≥ m√≥n").length;
      const kcal =
        countInDay === 3
          ? "~1,250 kcal"
          : countInDay === 2
          ? "~900 kcal"
          : countInDay === 1
          ? "~450 kcal"
          : "-";

      rows += `
        <tr>
          <td style="white-space:nowrap;"><b>${d}</b></td>
          <td>${b}</td>
          <td>${l}</td>
          <td>${di}</td>
          <td style="white-space:nowrap;">${kcal}</td>
        </tr>
      `;
    });

    const html = `
      <style>
        .pdf-badge{display:inline-block;padding:3px 10px;border-radius:999px;border:1px solid #e2e8f0;background:#f8fafc;font-size:12px;color:#334155;margin-right:6px;}
        .pdf-table{width:100%;border-collapse:collapse;font-size:12.8px;}
        .pdf-table th,.pdf-table td{border:1px solid #e2e8f0;padding:9px 8px;vertical-align:top;}
        .pdf-table th{background:#f1f5f9;text-align:left;color:#0f172a;}
        .pdf-muted{color:#64748b;font-size:12px;}
        .pdf-kpi{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
        .pdf-kpi .box{border:1px solid #e2e8f0;border-radius:12px;padding:10px;min-width:190px;}
        .pdf-kpi .l{font-size:12px;color:#64748b;}
        .pdf-kpi .v{font-size:14px;font-weight:900;color:#0f172a;margin-top:2px;}
        .sec{margin-top:14px;}
        .sec h3{margin:0 0 8px;color:#0f172a;}
        .ul{margin:6px 0 0; padding-left:18px;}
      </style>

      <div style="margin-bottom:10px;">
        <span class="pdf-badge">Tu·∫ßn: ${weekLabel}</span>
        <span class="pdf-badge">Report minh ho·∫°</span>
      </div>

      <div class="sec">
        <h3>1) B·∫£ng t·ªïng h·ª£p th·ª±c ƒë∆°n tu·∫ßn</h3>
        <table class="pdf-table">
          <thead>
            <tr>
              <th style="width:12%;">Ng√†y</th>
              <th style="width:26%;">S√°ng</th>
              <th style="width:26%;">Tr∆∞a</th>
              <th style="width:26%;">T·ªëi</th>
              <th style="width:10%;">Kcal</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        <div class="pdf-muted" style="margin-top:6px;">Kcal ch·ªâ mang t√≠nh minh ho·∫° ƒë·ªÉ ng∆∞·ªùi xem ƒë√°nh gi√° logic ph√¢n b·ªï b·ªØa ƒÉn.</div>
      </div>

      <div class="sec">
        <h3>2) Th·ªëng k√™ nhanh</h3>
        <div class="pdf-kpi">
          <div class="box"><div class="l">‚úÖ S·ªë b·ªØa ƒë√£ l√™n k·∫ø ho·∫°ch</div><div class="v">${plannedMeals} / 21</div></div>
          <div class="box"><div class="l">üçö M√≥n sinh vi√™n</div><div class="v">${studentCount}</div></div>
          <div class="box"><div class="l">üí™ M√≥n gym / healthy</div><div class="v">${gymCount}</div></div>
          <div class="box"><div class="l">üåà ƒê·ªô ƒëa d·∫°ng</div><div class="v">${diversityNote}</div></div>
        </div>
      </div>

      <div class="sec">
        <h3>3) Nh·∫≠n x√©t & g·ª£i √Ω c·∫£i thi·ªán</h3>
        <ul class="ul">
          <li>Ph√¢n b·ªï b·ªØa: <b>${
            plannedMeals >= 9 ? "kh√° ·ªïn" : "c·∫ßn b·ªï sung th√™m b·ªØa tr·ªëng"
          }</b>.</li>
          <li>C√¢n b·∫±ng nh√≥m m√≥n: <b>${balanceNote}</b>.</li>
          <li>G·ª£i √Ω: tƒÉng rau xanh/ƒë·∫°m v√†o ng√†y thi·∫øu b·ªØa; xen k·∫Ω 1‚Äì2 ng√†y eat clean ƒë·ªÉ c√¢n b·∫±ng.</li>
        </ul>
        <p class="pdf-muted" style="margin-top:8px;">Report ph·ª•c v·ª• ƒë√°nh gi√° ch·∫ø ƒë·ªô ƒÉn trong b√†i ti·ªÉu lu·∫≠n, kh√¥ng y√™u c·∫ßu ƒë√∫ng s·ªë li·ªáu dinh d∆∞·ª°ng.</p>
      </div>
    `;

    document.getElementById("print-area").innerHTML = buildPrintHTML({
      title: "B√ÅO C√ÅO TH·ª∞C ƒê∆†N TU·∫¶N",
      subTitle:
        "T·ªïng h·ª£p 7 ng√†y (S√°ng/Tr∆∞a/T·ªëi) + th·ªëng k√™ minh ho·∫° + nh·∫≠n x√©t.",
      contentHTML: html,
    });
    window.print();
  }

  document.addEventListener("DOMContentLoaded", () => {
    document
      .getElementById("export-day-pdf-btn")
      ?.addEventListener("click", exportDayPDF);
    document
      .getElementById("export-week-pdf-btn")
      ?.addEventListener("click", exportWeekPDF);
  });
</script>

<script src="/static/js/meal_planner.js"></script>
{% endblock %}
